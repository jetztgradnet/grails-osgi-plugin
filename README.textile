h1. Grails OSGi plugin

h2. About

The Grails OSGi plugin provides scripts to package a Grails application as an OSGi bundle. Additionally the bundle(s) may be run in an OSGi container assembled ad hoc by the excellent "Pax Runner":http://paxrunner.ops4j.org or deployed to a "SpringSource DM Server":http://www.springsource.org/dmserver

See also "Grails on OSGi":http://blog.jetztgrad.net/grails-on-osgi/ for details on running Grails applications in an OSGi environment.

h2. License

The OSGi plugin is released under the "Apache License 2.0":http://apache.org/licenses/LICENSE-2.0.txt.

h2. Installation

Simply call @grails install-plugin osgi@ to install the OSGi plugin

h2. Usage

h3. Creating an OSGi bundle from the Grails application

@grails bundle@
@grails prod bundle@ 

h3. Running the bundle

@grails run-bundle@
@grails prod run-bundle@

Note: at first start the OSGi runtime is assembled, which may take some time, while Maven is downloading the Internet...
Note: if the bundle exists, it won't be re-created automatically after changes. So for now use parameter @-forceBundle@ after changing something in the Grails app: @grails run-bundle -forceBundle@

h2. How it works

In order to be a valid OSGi bundle, the application is war'ed and provided with the necessary bundle manifest headers (see @scripts/_Event.groovy@ for details).
The bundle can be created using @grails bundle@.  

The OSGi runtime is assembled in the @target/osgi@ directory.

h2. Roadmap

* make bundle generation configurable (e.g. include/exclude dependencies, ...)
* make OSGi runtime created by @grails run-bundle@ and @grails assemble-osgi-runtime@ configurable
* support auto-reloading of changed artifacts
* export main Grails beans and application context as OSGi service
* export services as OSGi service (via @static expose = 'osgi'@)
* implement deployment to DM Server
* consider other deployment options: Apache Karaf, ...

h2. History

h3. 0.2 (2010-07-11)

* using Spring DM instead of Pax Web as Web extender
* replaced (most) dependencies from bundle by OSGi bundles from the "SpringSource Enterprise Repository":http://www.springsource.com/repository
* provide access to OSGi @BundleContext@ to artifacts (controllers, services, ...) via Spring injection as bean @bundleContext@:
Example: controller accessing bundle context

bc. class OsgiTestController {
    def bundleContext
    def index = {
        def bundles = []
        if (bundleContext) {
            bundles = bundleContext.bundles
        }
        else {
            flash.message = "bundleContext NOT available"
        }
        [ bundles: bundles ]
    }
}


h3. 0.1 (2010-01-03)

* initial version
* uses PAX Runner to run osgi-fied Grails app
* Grails app is war'ed and extended with required OSGi bundle headers to create a single, big, monolithic bundle


